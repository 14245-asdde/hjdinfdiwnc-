<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - DiamonD</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='white'/%3E%3Ctext x='50' y='72' font-family='Arial,sans-serif' font-size='65' font-weight='900' text-anchor='middle' fill='black'%3ED%3C/text%3E%3C/svg%3E">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        body { background: #0a0a0a; }
    </style>
</head>
<body class="text-white min-h-screen">
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-[#0a0a0a]/95 backdrop-blur-xl border-b border-white/5">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <a href="index.html" class="flex items-center gap-3">
                    <img src="p3.png" alt="DiamonD" class="w-10 h-10 rounded-xl">
                    <span class="text-xl font-bold tracking-tight">DiamonD</span>
                </a>
                <div class="hidden md:flex items-center gap-1">
                    <a href="index.html" class="px-4 py-2 text-neutral-400 hover:text-white hover:bg-white/5 rounded-lg transition">–ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="shop.html" class="px-4 py-2 text-neutral-400 hover:text-white hover:bg-white/5 rounded-lg transition">–ú–∞–≥–∞–∑–∏–Ω</a>
                    <a href="profile.html" class="px-4 py-2 text-neutral-400 hover:text-white hover:bg-white/5 rounded-lg transition">–ü—Ä–æ—Ñ–∏–ª—å</a>
                    <a href="admin.html" class="px-4 py-2 text-amber-400 bg-amber-500/10 rounded-lg font-medium">–ê–¥–º–∏–Ω</a>
                </div>
                <div class="flex items-center gap-3">
                    <span class="text-amber-400 font-medium hidden md:block">üëë –ê–¥–º–∏–Ω</span>
                    <button onclick="logout()" class="bg-white/5 hover:bg-red-500/10 text-neutral-400 hover:text-red-400 px-4 py-2.5 rounded-xl font-semibold transition text-sm border border-white/10">–í—ã–π—Ç–∏</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Access Denied -->
    <div id="accessDenied" class="hidden pt-32 pb-20 px-6">
        <div class="max-w-md mx-auto text-center">
            <div class="w-24 h-24 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-8 border border-red-500/20">
                <svg class="w-12 h-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
            </div>
            <h1 class="text-3xl font-bold mb-3">–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</h1>
            <p class="text-neutral-500 mb-8">–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>
            <a href="index.html" class="inline-block bg-white hover:bg-neutral-200 text-black px-8 py-3.5 rounded-xl font-bold transition">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
    </div>

    <!-- Admin Content -->
    <div id="adminContent" class="hidden pt-28 pb-20 px-6">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-3xl font-black mb-2">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h1>
                <p class="text-neutral-500">–ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∞–π—Ç–æ–º DiamonD</p>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div class="bg-[#111] rounded-2xl border border-white/10 p-5">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 bg-blue-500/20 rounded-xl flex items-center justify-center">
                            <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        </div>
                        <p class="text-neutral-500 text-sm">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                    </div>
                    <p class="text-3xl font-black" id="statUsers">0</p>
                </div>
                <div class="bg-[#111] rounded-2xl border border-white/10 p-5">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center">
                            <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                        <p class="text-neutral-500 text-sm">–î–æ—Ö–æ–¥</p>
                    </div>
                    <p class="text-3xl font-black" id="statIncome">0‚ÇΩ</p>
                </div>
                <div class="bg-[#111] rounded-2xl border border-white/10 p-5">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 bg-purple-500/20 rounded-xl flex items-center justify-center">
                            <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path></svg>
                        </div>
                        <p class="text-neutral-500 text-sm">–ü—Ä–æ–¥–∞–Ω–æ</p>
                    </div>
                    <p class="text-3xl font-black" id="statSold">0</p>
                </div>
                <div class="bg-[#111] rounded-2xl border border-white/10 p-5">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 bg-amber-500/20 rounded-xl flex items-center justify-center">
                            <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>
                        </div>
                        <p class="text-neutral-500 text-sm">–ù–∞ —Å–∫–ª–∞–¥–µ</p>
                    </div>
                    <p class="text-3xl font-black" id="statStock">0</p>
                </div>
            </div>

            <!-- Main Grid -->
            <div class="grid lg:grid-cols-2 gap-6 mb-6">
                <!-- Promo Codes -->
                <div class="bg-[#111] rounded-2xl border border-white/10 p-6">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="text-xl">üéüÔ∏è</span> –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
                    </h3>
                    <div class="grid grid-cols-3 gap-3 mb-3">
                        <input type="text" id="promoCode" placeholder="–ö–û–î" class="bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-white/30 uppercase">
                        <input type="number" id="promoDiscount" placeholder="–°–∫–∏–¥–∫–∞ %" min="1" max="100" class="bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-white/30">
                        <input type="number" id="promoUses" placeholder="–ö–æ–ª-–≤–æ" min="1" class="bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-white/30">
                    </div>
                    <button onclick="createPromoCode()" class="w-full bg-white hover:bg-neutral-200 text-black py-3 rounded-xl font-semibold transition">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
                    <div id="promoList" class="mt-4 space-y-2 max-h-32 overflow-y-auto"></div>
                </div>
            </div>

            <!-- Keys Management -->
            <div class="grid lg:grid-cols-2 gap-6 mb-6">
                <!-- Add Keys -->
                <div class="bg-[#111] rounded-2xl border border-white/10 p-6">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="text-xl">üîë</span> –î–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á–∏ –Ω–∞ —Å–∫–ª–∞–¥
                    </h3>
                    <div class="mb-3">
                        <select id="addKeyType" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-white/30 mb-3">
                            <option value="week">–ù–µ–¥–µ–ª—è VIP (69‚ÇΩ)</option>
                            <option value="month">–ú–µ—Å—è—Ü VIP (149‚ÇΩ)</option>
                            <option value="halfyear">–ü–æ–ª –≥–æ–¥–∞ VIP (319‚ÇΩ)</option>
                            <option value="forever">VIP –ù–∞–≤—Å–µ–≥–¥–∞ (639‚ÇΩ)</option>
                        </select>
                        <textarea id="addKeysText" rows="4" placeholder="–ö–∞–∂–¥—ã–π –∫–ª—é—á —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏..." class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-white/30 resize-none font-mono text-sm"></textarea>
                    </div>
                    <button onclick="addKeysToStock()" class="w-full bg-green-600 hover:bg-green-500 py-3 rounded-xl font-semibold transition">–î–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á–∏</button>
                </div>

                <!-- Issue Key -->
                <div class="bg-[#111] rounded-2xl border border-white/10 p-6">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="text-xl">üéÅ</span> –í—ã–¥–∞—Ç—å –∫–ª—é—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                    </h3>
                    <input type="text" id="issueEmail" placeholder="–ù–∏–∫–Ω–µ–π–º –∏–ª–∏ Email" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-white/30 mb-3">
                    <select id="issueKeyType" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-white/30 mb-3">
                        <option value="week">–ù–µ–¥–µ–ª—è VIP</option>
                        <option value="month">–ú–µ—Å—è—Ü VIP</option>
                        <option value="halfyear">–ü–æ–ª –≥–æ–¥–∞ VIP</option>
                        <option value="forever">VIP –ù–∞–≤—Å–µ–≥–¥–∞</option>
                    </select>
                    <button onclick="issueKeyToUser()" class="w-full bg-white hover:bg-neutral-200 text-black py-3 rounded-xl font-semibold transition">–í—ã–¥–∞—Ç—å –∫–ª—é—á</button>
                    
                    <!-- Stock Display -->
                    <div class="grid grid-cols-4 gap-2 mt-4">
                        <div class="bg-white/5 rounded-lg p-2 text-center cursor-pointer hover:bg-white/10" onclick="showStockKeys('week')">
                            <p class="text-xs text-neutral-500">–ù–µ–¥–µ–ª—è</p>
                            <p class="font-bold" id="stockWeek">0</p>
                        </div>
                        <div class="bg-white/5 rounded-lg p-2 text-center cursor-pointer hover:bg-white/10" onclick="showStockKeys('month')">
                            <p class="text-xs text-neutral-500">–ú–µ—Å—è—Ü</p>
                            <p class="font-bold" id="stockMonth">0</p>
                        </div>
                        <div class="bg-white/5 rounded-lg p-2 text-center cursor-pointer hover:bg-white/10" onclick="showStockKeys('halfyear')">
                            <p class="text-xs text-neutral-500">–ü–æ–ª–≥–æ–¥–∞</p>
                            <p class="font-bold" id="stockHalfyear">0</p>
                        </div>
                        <div class="bg-white/5 rounded-lg p-2 text-center cursor-pointer hover:bg-white/10" onclick="showStockKeys('forever')">
                            <p class="text-xs text-neutral-500">–ù–∞–≤—Å–µ–≥–¥–∞</p>
                            <p class="font-bold" id="stockForever">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logs & Mailing -->
            <div class="grid lg:grid-cols-2 gap-6 mb-6">
                <!-- Logs -->
                <div class="bg-[#111] rounded-2xl border border-white/10 p-6">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="text-xl">üìù</span> –õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π
                    </h3>
                    <div id="logsList" class="space-y-2 max-h-64 overflow-y-auto">
                        <p class="text-neutral-500 text-center py-4">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>

                <!-- Mailing -->
                <div class="bg-[#111] rounded-2xl border border-white/10 p-6">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="text-xl">üìß</span> –†–∞—Å—Å—ã–ª–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                    </h3>
                    <input type="text" id="mailSubject" placeholder="–¢–µ–º–∞ –ø–∏—Å—å–º–∞" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-white/30 mb-3">
                    <textarea id="mailContent" rows="4" placeholder="–¢–µ–∫—Å—Ç –ø–∏—Å—å–º–∞..." class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-white/30 resize-none mb-3"></textarea>
                    <button onclick="sendMassNotification()" class="w-full bg-blue-600 hover:bg-blue-500 py-3 rounded-xl font-semibold transition">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º (<span id="mailCount">0</span> —á–µ–ª.)</button>
                </div>
            </div>

            <!-- Reviews Moderation -->
            <div class="bg-[#111] rounded-2xl border border-white/10 p-6 mb-6">
                <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                    <span class="text-xl">‚≠ê</span> –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤
                </h3>
                <div id="reviewsModeration" class="space-y-3 max-h-64 overflow-y-auto">
                    <p class="text-neutral-500 text-center py-4">–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</p>
                </div>
            </div>

            <!-- Users List -->
            <div class="bg-[#111] rounded-2xl border border-white/10 p-6">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                    <h3 class="font-bold text-lg flex items-center gap-2">
                        <span class="text-xl">üë•</span> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                    </h3>
                    <div class="relative">
                        <svg class="w-5 h-5 text-neutral-500 absolute left-4 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        <input type="text" id="searchUsers" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∏–∫—É –∏–ª–∏ email..." oninput="filterUsers()" class="w-full md:w-80 bg-white/5 border border-white/10 rounded-xl pl-12 pr-4 py-3 focus:outline-none focus:border-white/30 transition text-sm">
                    </div>
                </div>
                <div id="usersList" class="space-y-3 max-h-[500px] overflow-y-auto">
                    <p class="text-neutral-500 text-center py-10">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Keys Modal -->
    <div id="stockKeysModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
        <div class="bg-[#111] rounded-2xl p-6 max-w-lg w-full border border-white/10 relative max-h-[80vh] overflow-hidden flex flex-col">
            <button onclick="hideModal('stockKeys')" class="absolute top-4 right-4 w-10 h-10 bg-white/5 hover:bg-white/10 rounded-xl flex items-center justify-center text-neutral-400 hover:text-white transition">&times;</button>
            <h2 class="text-xl font-bold mb-4" id="stockKeysTitle">–ö–ª—é—á–∏ –Ω–∞ —Å–∫–ª–∞–¥–µ</h2>
            <div id="stockKeysList" class="space-y-2 overflow-y-auto flex-1">
                <p class="text-neutral-500 text-center py-8">–ù–µ—Ç –∫–ª—é—á–µ–π</p>
            </div>
        </div>
    </div>

    <!-- User Keys Modal -->
    <div id="userKeysModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
        <div class="bg-[#111] rounded-2xl p-6 max-w-lg w-full border border-white/10 relative max-h-[80vh] overflow-hidden flex flex-col">
            <button onclick="hideModal('userKeys')" class="absolute top-4 right-4 w-10 h-10 bg-white/5 hover:bg-white/10 rounded-xl flex items-center justify-center text-neutral-400 hover:text-white transition">&times;</button>
            <h2 class="text-xl font-bold mb-4" id="userKeysTitle">–ö–ª—é—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <div id="userKeysList" class="space-y-3 overflow-y-auto flex-1">
                <p class="text-neutral-500 text-center py-8">–ù–µ—Ç –∫–ª—é—á–µ–π</p>
            </div>
        </div>
    </div>

    <!-- User Management Modal -->
    <div id="userManageModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
        <div class="bg-[#111] rounded-2xl p-6 max-w-md w-full border border-white/10 relative max-h-[90vh] overflow-y-auto">
            <button onclick="hideModal('userManage')" class="absolute top-4 right-4 w-10 h-10 bg-white/5 hover:bg-white/10 rounded-xl flex items-center justify-center text-neutral-400 hover:text-white transition">&times;</button>
            <h2 class="text-xl font-bold mb-2" id="manageUserTitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º</h2>
            <p class="text-neutral-500 mb-6" id="manageUserEmail">user@example.com</p>
            
            <input type="hidden" id="manageUserId">
            
            <!-- Ban/Unban -->
            <div class="mb-4">
                <button id="banUserBtn" onclick="toggleBanUser()" class="w-full bg-red-500/20 hover:bg-red-500/30 text-red-400 py-3 rounded-xl font-semibold transition border border-red-500/20">
                    üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                </button>
            </div>
            
            <!-- Change Password -->
            <div class="mb-4">
                <label class="block text-neutral-400 text-sm mb-2">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                <div class="flex gap-2">
                    <input type="text" id="adminNewPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" class="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-white/30">
                    <button onclick="adminChangePassword()" class="bg-white hover:bg-neutral-200 text-black px-5 py-3 rounded-xl font-semibold transition">–°–º–µ–Ω–∏—Ç—å</button>
                </div>
            </div>
            
            <!-- User Keys with Remove -->
            <div class="mb-4">
                <label class="block text-neutral-400 text-sm mb-2">–ö–ª—é—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <div id="manageUserKeys" class="space-y-2 max-h-40 overflow-y-auto">
                    <p class="text-neutral-500 text-sm">–ù–µ—Ç –∫–ª—é—á–µ–π</p>
                </div>
            </div>
            
            <!-- Delete Account -->
            <button onclick="adminDeleteUser()" class="w-full bg-red-500/10 hover:bg-red-500/20 text-red-400 py-3 rounded-xl font-semibold transition border border-red-500/20 flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
            </button>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-6 right-6 px-6 py-4 rounded-xl shadow-2xl transform translate-y-20 opacity-0 transition-all duration-300 z-50 border">
        <span id="toastMessage"></span>
    </div>

    <!-- Footer -->
    <footer class="py-10 px-6 border-t border-white/5">
        <div class="max-w-6xl mx-auto">
            <div class="flex flex-col items-center gap-6">
                <a href="index.html" class="flex items-center gap-3">
                    <img src="p3.png" alt="DiamonD" class="w-8 h-8 rounded-lg">
                    <span class="text-lg font-bold tracking-tight">DiamonD</span>
                </a>
                <div class="flex items-center gap-6 text-sm">
                    <a href="https://discord.com/users/ebatelmamok100_7" target="_blank" class="text-neutral-500 hover:text-white transition flex items-center gap-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/></svg>
                        ebatelmamok100_7
                    </a>
                    <a href="https://t.me/arishka_332" target="_blank" class="text-neutral-500 hover:text-white transition flex items-center gap-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
                        @arishka_332
                    </a>
                </div>
                <div class="flex items-center gap-6 text-sm">
                    <a href="privacy.html" class="text-neutral-500 hover:text-white transition">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a>
                    <a href="terms.html" class="text-neutral-500 hover:text-white transition">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
                </div>
                <p class="text-neutral-600 text-sm">¬© 2024 DiamonD. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="module" src="app.js"></script>
    <script type="module">
        import { } from './app.js';
        
        let allUsers = [];
        let keyStock = { week: [], month: [], halfyear: [], forever: [] };
        
        window.addEventListener('appReady', () => {
            checkAdminAccess();
        });

        async function checkAdminAccess() {
            const currentUser = getCurrentUser();
            if (!currentUser || currentUser.role !== 'admin') {
                document.getElementById('accessDenied').classList.remove('hidden');
                document.getElementById('adminContent').classList.add('hidden');
            } else {
                document.getElementById('accessDenied').classList.add('hidden');
                document.getElementById('adminContent').classList.remove('hidden');
                await loadAdminData();
            }
        }

        async function loadAdminData() {
            // Load users
            const usersRef = collection(db, "users");
            const usersSnapshot = await getDocs(usersRef);
            allUsers = [];
            let totalIncome = 0;
            let totalSold = 0;
            usersSnapshot.forEach(doc => {
                const user = doc.data();
                allUsers.push(user);
                totalIncome += user.totalSpent || 0;
                totalSold += user.keys ? user.keys.length : 0;
            });
            
            // Load key stock
            const stockRef = doc(db, "settings", "keyStock");
            const stockSnap = await getDoc(stockRef);
            keyStock = stockSnap.exists() ? stockSnap.data() : { week: [], month: [], halfyear: [], forever: [] };
            
            const totalStock = (keyStock.week?.length || 0) + (keyStock.month?.length || 0) + (keyStock.halfyear?.length || 0) + (keyStock.forever?.length || 0);
            
            // Update stats
            document.getElementById('statUsers').textContent = allUsers.length;
            document.getElementById('statIncome').textContent = totalIncome + '‚ÇΩ';
            document.getElementById('statSold').textContent = totalSold;
            document.getElementById('statStock').textContent = totalStock;
            document.getElementById('mailCount').textContent = allUsers.length;
            
            // Update stock display
            document.getElementById('stockWeek').textContent = keyStock.week?.length || 0;
            document.getElementById('stockMonth').textContent = keyStock.month?.length || 0;
            document.getElementById('stockHalfyear').textContent = keyStock.halfyear?.length || 0;
            document.getElementById('stockForever').textContent = keyStock.forever?.length || 0;
            
            // Load sale timer
            const saleRef = doc(db, "settings", "saleTimer");
            const saleSnap = await getDoc(saleRef);
            if (saleSnap.exists()) {
                document.getElementById('saleActive').checked = saleSnap.data().isActive;
            }
            
            // Load promo codes
            await loadPromoCodes();
            
            // Load logs
            await loadLogs();
            
            // Load reviews for moderation
            await loadReviewsModeration();
            
            // Render users
            renderUsers();
        }

        async function loadPromoCodes() {
            const promoRef = doc(db, "settings", "promoCodes");
            const promoSnap = await getDoc(promoRef);
            const codes = promoSnap.exists() ? promoSnap.data().codes : [];
            
            const list = document.getElementById('promoList');
            if (codes.length === 0) {
                list.innerHTML = '<p class="text-neutral-500 text-sm">–ù–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤</p>';
            } else {
                list.innerHTML = codes.map((p, i) => `
                    <div class="flex items-center justify-between bg-white/5 rounded-lg px-3 py-2">
                        <div>
                            <span class="font-mono font-bold">${p.code}</span>
                            <span class="text-green-400 ml-2">-${p.discount}%</span>
                            <span class="text-neutral-500 text-sm ml-2">(${p.usesLeft} –∏—Å–ø.)</span>
                        </div>
                        <button onclick="deletePromoCode(${i})" class="text-red-400 hover:text-red-300 p-1">‚úï</button>
                    </div>
                `).join('');
            }
        }

        async function loadLogs() {
            const logsRef = doc(db, "settings", "logs");
            const logsSnap = await getDoc(logsRef);
            const logs = logsSnap.exists() ? logsSnap.data().items : [];
            
            const list = document.getElementById('logsList');
            if (logs.length === 0) {
                list.innerHTML = '<p class="text-neutral-500 text-center py-4">–ù–µ—Ç –ª–æ–≥–æ–≤</p>';
            } else {
                list.innerHTML = logs.slice(0, 50).map(log => `
                    <div class="bg-white/5 rounded-lg px-3 py-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-neutral-400">${log.action}</span>
                            <span class="text-neutral-600">${log.timestamp}</span>
                        </div>
                        <p class="text-white">${log.details}</p>
                    </div>
                `).join('');
            }
        }

        async function loadReviewsModeration() {
            const reviewsRef = doc(db, "settings", "reviews");
            const reviewsSnap = await getDoc(reviewsRef);
            const reviews = reviewsSnap.exists() ? reviewsSnap.data().items : [];
            
            const pending = reviews.filter(r => !r.isApproved);
            const container = document.getElementById('reviewsModeration');
            
            if (pending.length === 0) {
                container.innerHTML = '<p class="text-neutral-500 text-center py-4">–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</p>';
            } else {
                container.innerHTML = pending.map((r, i) => `
                    <div class="bg-white/5 rounded-xl p-4 border border-white/5">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <span class="font-bold">${r.userName}</span>
                                <span class="text-amber-400 ml-2">${'‚≠ê'.repeat(r.rating)}</span>
                            </div>
                            <span class="text-neutral-500 text-sm">${r.date}</span>
                        </div>
                        <p class="text-neutral-300 mb-3">${r.text}</p>
                        <div class="flex gap-2">
                            <button onclick="approveReview(${r.id})" class="flex-1 bg-green-500/20 hover:bg-green-500/30 text-green-400 py-2 rounded-lg font-medium transition">‚úì –û–¥–æ–±—Ä–∏—Ç—å</button>
                            <button onclick="deleteReview(${r.id})" class="flex-1 bg-red-500/20 hover:bg-red-500/30 text-red-400 py-2 rounded-lg font-medium transition">‚úï –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function renderUsers() {
            const currentUser = getCurrentUser();
            const list = document.getElementById('usersList');
            
            if (allUsers.length === 0) {
                list.innerHTML = '<p class="text-neutral-500 text-center py-10">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>';
                return;
            }
            
            list.innerHTML = allUsers.map(u => `
                <div class="bg-white/5 rounded-xl border border-white/5 hover:border-white/10 transition p-4">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-neutral-800 rounded-xl flex items-center justify-center font-bold border border-white/10">
                                ${u.name[0].toUpperCase()}
                            </div>
                            <div>
                                <div class="flex items-center gap-2">
                                    <p class="font-bold">${u.name}</p>
                                    ${u.role === 'admin' ? '<span class="text-amber-400 text-sm">üëë</span>' : ''}
                                    ${u.isBanned ? '<span class="text-red-400 text-sm">üö´</span>' : ''}
                                </div>
                                <p class="text-neutral-500 text-sm">${u.email}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="showUserKeys('${u.id}')" class="flex items-center gap-2 bg-white/5 hover:bg-white/10 px-3 py-2 rounded-lg transition border border-white/10 text-sm">
                                üîë ${u.keys ? u.keys.length : 0}
                            </button>
                            ${u.id !== currentUser.id ? `
                                <button onclick="openUserManage('${u.id}')" class="bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg transition border border-white/10 text-sm font-medium">
                                    ‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                                </button>
                            ` : '<span class="text-amber-400 text-xs">–≠—Ç–æ –≤—ã</span>'}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Toggle sale timer
        window.toggleSaleTimer = async function() {
            const isActive = document.getElementById('saleActive').checked;
            const saleRef = doc(db, "settings", "saleTimer");
            await updateDoc(saleRef, { isActive });
            showToast(isActive ? '–¢–∞–π–º–µ—Ä –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω' : '–¢–∞–π–º–µ—Ä –æ—Ç–∫–ª—é—á—ë–Ω');
        };

        // Set sale timer
        window.setSaleTimer = async function() {
            const hours = parseInt(document.getElementById('saleHours').value) || 24;
            const endTime = Date.now() + hours * 60 * 60 * 1000;
            const saleRef = doc(db, "settings", "saleTimer");
            await updateDoc(saleRef, { endTime, isActive: true });
            document.getElementById('saleActive').checked = true;
            document.getElementById('saleHours').value = '';
            showToast(`–¢–∞–π–º–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ ${hours} —á–∞—Å–æ–≤`);
        };

        // Create promo code
        window.createPromoCode = async function() {
            const code = document.getElementById('promoCode').value.trim().toUpperCase();
            const discount = parseInt(document.getElementById('promoDiscount').value);
            const uses = parseInt(document.getElementById('promoUses').value);
            
            if (!code || !discount || !uses) {
                showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            const promoRef = doc(db, "settings", "promoCodes");
            const promoSnap = await getDoc(promoRef);
            const codes = promoSnap.exists() ? promoSnap.data().codes : [];
            
            codes.push({ code, discount, usesLeft: uses, isActive: true });
            await updateDoc(promoRef, { codes });
            
            document.getElementById('promoCode').value = '';
            document.getElementById('promoDiscount').value = '';
            document.getElementById('promoUses').value = '';
            
            await loadPromoCodes();
            showToast(`–ü—Ä–æ–º–æ–∫–æ–¥ ${code} —Å–æ–∑–¥–∞–Ω!`);
        };

        // Delete promo code
        window.deletePromoCode = async function(index) {
            const promoRef = doc(db, "settings", "promoCodes");
            const promoSnap = await getDoc(promoRef);
            const codes = promoSnap.data().codes;
            codes.splice(index, 1);
            await updateDoc(promoRef, { codes });
            await loadPromoCodes();
            showToast('–ü—Ä–æ–º–æ–∫–æ–¥ —É–¥–∞–ª—ë–Ω');
        };

        // Add keys to stock
        window.addKeysToStock = async function() {
            const type = document.getElementById('addKeyType').value;
            const keysText = document.getElementById('addKeysText').value.trim();
            
            if (!keysText) {
                showToast('–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–∏', 'error');
                return;
            }
            
            const keys = keysText.split('\n').map(k => k.trim()).filter(k => k.length > 0);
            
            const stockRef = doc(db, "settings", "keyStock");
            const newStock = [...(keyStock[type] || []), ...keys];
            await updateDoc(stockRef, { [type]: newStock });
            
            document.getElementById('addKeysText').value = '';
            await loadAdminData();
            showToast(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${keys.length} –∫–ª—é—á–µ–π`);
        };

        // Issue key to user
        window.issueKeyToUser = async function() {
            const loginValue = document.getElementById('issueEmail').value.trim();
            const type = document.getElementById('issueKeyType').value;
            
            if (!loginValue) {
                showToast('–í–≤–µ–¥–∏—Ç–µ email –∏–ª–∏ –Ω–∏–∫–Ω–µ–π–º', 'error');
                return;
            }
            
            const user = allUsers.find(u => u.email === loginValue || u.name.toLowerCase() === loginValue.toLowerCase());
            
            if (!user) {
                showToast('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }
            
            if (!keyStock[type] || keyStock[type].length === 0) {
                showToast('–ù–µ—Ç –∫–ª—é—á–µ–π –Ω–∞ —Å–∫–ª–∞–¥–µ', 'error');
                return;
            }
            
            const keyNames = { week: '–ù–µ–¥–µ–ª—è VIP', month: '–ú–µ—Å—è—Ü VIP', halfyear: '–ü–æ–ª –≥–æ–¥–∞ VIP', forever: 'VIP –ù–∞–≤—Å–µ–≥–¥–∞' };
            const takenKey = keyStock[type][0];
            const newStock = [...keyStock[type]];
            newStock.shift();
            
            await updateDoc(doc(db, "settings", "keyStock"), { [type]: newStock });
            
            const newKey = {
                id: Date.now(),
                type,
                name: keyNames[type],
                key: takenKey,
                purchaseDate: new Date().toLocaleDateString('ru-RU'),
                price: 0,
                isGift: true
            };
            
            await updateDoc(doc(db, "users", user.id), { keys: arrayUnion(newKey) });
            
            document.getElementById('issueEmail').value = '';
            await loadAdminData();
            await addLog('gift_key', `–ê–¥–º–∏–Ω –≤—ã–¥–∞–ª ${keyNames[type]} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${user.name}`);
            showToast(`–ö–ª—é—á –≤—ã–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${user.name}`);
        };

        // Show stock keys
        window.showStockKeys = function(type) {
            const typeNames = { week: '–ù–µ–¥–µ–ª—è VIP', month: '–ú–µ—Å—è—Ü VIP', halfyear: '–ü–æ–ª –≥–æ–¥–∞ VIP', forever: 'VIP –ù–∞–≤—Å–µ–≥–¥–∞' };
            document.getElementById('stockKeysTitle').textContent = `–ö–ª—é—á–∏: ${typeNames[type]}`;
            
            const keys = keyStock[type] || [];
            const list = document.getElementById('stockKeysList');
            
            if (keys.length === 0) {
                list.innerHTML = '<p class="text-neutral-500 text-center py-8">–ù–µ—Ç –∫–ª—é—á–µ–π</p>';
            } else {
                list.innerHTML = keys.map((key, i) => `
                    <div class="flex items-center justify-between bg-white/5 rounded-lg px-4 py-3">
                        <code class="font-mono text-sm">${key}</code>
                        <button onclick="deleteStockKey('${type}', ${i})" class="text-red-400 hover:text-red-300 p-1">‚úï</button>
                    </div>
                `).join('');
            }
            
            showModal('stockKeys');
        };

        // Delete stock key
        window.deleteStockKey = async function(type, index) {
            const stockRef = doc(db, "settings", "keyStock");
            const newStock = [...keyStock[type]];
            newStock.splice(index, 1);
            await updateDoc(stockRef, { [type]: newStock });
            keyStock[type] = newStock;
            showStockKeys(type);
            await loadAdminData();
            showToast('–ö–ª—é—á —É–¥–∞–ª—ë–Ω');
        };

        // Show user keys
        window.showUserKeys = function(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;
            
            document.getElementById('userKeysTitle').textContent = `–ö–ª—é—á–∏: ${user.name}`;
            const keys = user.keys || [];
            const list = document.getElementById('userKeysList');
            
            if (keys.length === 0) {
                list.innerHTML = '<p class="text-neutral-500 text-center py-8">–ù–µ—Ç –∫–ª—é—á–µ–π</p>';
            } else {
                list.innerHTML = keys.map(k => `
                    <div class="bg-white/5 rounded-xl p-4 border border-white/5">
                        <div class="flex justify-between mb-2">
                            <span class="font-bold">${k.name}</span>
                            <span class="text-neutral-500 text-sm">${k.purchaseDate}</span>
                        </div>
                        <code class="font-mono text-sm text-neutral-300">${k.key}</code>
                        ${k.isGift ? '<span class="ml-2 text-green-400 text-xs">–ü–æ–¥–∞—Ä–æ–∫</span>' : `<span class="ml-2 text-white">${k.price}‚ÇΩ</span>`}
                    </div>
                `).join('');
            }
            
            showModal('userKeys');
        };

        // Open user manage modal
        let currentManagedUser = null;
        
        window.openUserManage = function(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;
            
            currentManagedUser = user;
            document.getElementById('manageUserId').value = userId;
            document.getElementById('manageUserTitle').textContent = user.name;
            document.getElementById('manageUserEmail').textContent = user.email;
            document.getElementById('adminNewPassword').value = '';
            
            // Update ban button
            const banBtn = document.getElementById('banUserBtn');
            if (user.isBanned) {
                banBtn.innerHTML = '‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å';
                banBtn.className = 'w-full bg-green-500/20 hover:bg-green-500/30 text-green-400 py-3 rounded-xl font-semibold transition border border-green-500/20';
            } else {
                banBtn.innerHTML = 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å';
                banBtn.className = 'w-full bg-red-500/20 hover:bg-red-500/30 text-red-400 py-3 rounded-xl font-semibold transition border border-red-500/20';
            }
            
            // Show user keys
            const keys = user.keys || [];
            const keysContainer = document.getElementById('manageUserKeys');
            
            if (keys.length === 0) {
                keysContainer.innerHTML = '<p class="text-neutral-500 text-sm">–ù–µ—Ç –∫–ª—é—á–µ–π</p>';
            } else {
                keysContainer.innerHTML = keys.map((k, i) => `
                    <div class="flex items-center justify-between bg-white/5 rounded-lg px-3 py-2">
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium truncate">${k.name}</p>
                            <code class="text-xs text-neutral-400">${k.key}</code>
                        </div>
                        <button onclick="removeUserKey('${userId}', ${i})" class="ml-2 text-red-400 hover:text-red-300 p-1">‚úï</button>
                    </div>
                `).join('');
            }
            
            showModal('userManage');
        };

        // Toggle ban user
        window.toggleBanUser = async function() {
            if (!currentManagedUser) return;
            
            const newBanStatus = !currentManagedUser.isBanned;
            await updateDoc(doc(db, "users", currentManagedUser.id), { isBanned: newBanStatus });
            
            await addLog(newBanStatus ? 'ban_user' : 'unban_user', `${currentManagedUser.name} –±—ã–ª ${newBanStatus ? '–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω'}`);
            
            hideModal('userManage');
            await loadAdminData();
            showToast(newBanStatus ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
        };

        // Admin change password
        window.adminChangePassword = async function() {
            const userId = document.getElementById('manageUserId').value;
            const newPassword = document.getElementById('adminNewPassword').value;
            
            if (!newPassword || newPassword.length < 6) {
                showToast('–ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }
            
            await updateDoc(doc(db, "users", userId), { password: newPassword });
            document.getElementById('adminNewPassword').value = '';
            showToast('–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω—ë–Ω!');
        };

        // Remove key from user
        window.removeUserKey = async function(userId, keyIndex) {
            const user = allUsers.find(u => u.id === userId);
            if (!user || !user.keys) return;
            
            const newKeys = [...user.keys];
            newKeys.splice(keyIndex, 1);
            
            await updateDoc(doc(db, "users", userId), { keys: newKeys });
            await loadAdminData();
            openUserManage(userId);
            showToast('–ö–ª—é—á —É–¥–∞–ª—ë–Ω');
        };

        // Admin delete user
        window.adminDeleteUser = async function() {
            const userId = document.getElementById('manageUserId').value;
            
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) return;
            
            await deleteDoc(doc(db, "users", userId));
            hideModal('userManage');
            await loadAdminData();
            showToast('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—ë–Ω');
        };

        // Send mass notification to all users
        window.sendMassNotification = async function() {
            const subject = document.getElementById('mailSubject').value.trim();
            const message = document.getElementById('mailContent').value.trim();
            
            if (!subject || !message) {
                showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–º—É –∏ —Ç–µ–∫—Å—Ç', 'error');
                return;
            }
            
            const notification = {
                id: Date.now(),
                subject,
                message,
                date: new Date().toLocaleDateString('ru-RU'),
                isRead: false
            };
            
            let sent = 0;
            for (const user of allUsers) {
                const notifications = user.notifications || [];
                notifications.unshift(notification);
                await updateDoc(doc(db, "users", user.id), { notifications });
                sent++;
            }
            
            document.getElementById('mailSubject').value = '';
            document.getElementById('mailContent').value = '';
            
            await addLog('mass_notification', `–†–∞—Å—Å—ã–ª–∫–∞: "${subject}" - ${sent} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
            showToast(`–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${sent} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º!`);
        };

        // Approve review
        window.approveReview = async function(reviewId) {
            const reviewsRef = doc(db, "settings", "reviews");
            const reviewsSnap = await getDoc(reviewsRef);
            const reviews = reviewsSnap.data().items;
            
            const updated = reviews.map(r => {
                if (r.id === reviewId) r.isApproved = true;
                return r;
            });
            
            await updateDoc(reviewsRef, { items: updated });
            await loadReviewsModeration();
            showToast('–û—Ç–∑—ã–≤ –æ–¥–æ–±—Ä–µ–Ω');
        };

        // Delete review
        window.deleteReview = async function(reviewId) {
            const reviewsRef = doc(db, "settings", "reviews");
            const reviewsSnap = await getDoc(reviewsRef);
            const reviews = reviewsSnap.data().items.filter(r => r.id !== reviewId);
            
            await updateDoc(reviewsRef, { items: reviews });
            await loadReviewsModeration();
            showToast('–û—Ç–∑—ã–≤ —É–¥–∞–ª—ë–Ω');
        };

        // Filter users
        window.filterUsers = function() {
            const search = document.getElementById('searchUsers').value.toLowerCase().trim();
            const currentUser = getCurrentUser();
            
            let filtered = allUsers;
            if (search) {
                filtered = allUsers.filter(u => 
                    u.name.toLowerCase().includes(search) || 
                    u.email.toLowerCase().includes(search)
                );
            }
            
            const list = document.getElementById('usersList');
            
            if (filtered.length === 0) {
                list.innerHTML = '<p class="text-neutral-500 text-center py-10">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }
            
            list.innerHTML = filtered.map(u => `
                <div class="bg-white/5 rounded-xl border border-white/5 hover:border-white/10 transition p-4">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-neutral-800 rounded-xl flex items-center justify-center font-bold border border-white/10">
                                ${u.name[0].toUpperCase()}
                            </div>
                            <div>
                                <div class="flex items-center gap-2">
                                    <p class="font-bold">${u.name}</p>
                                    ${u.role === 'admin' ? '<span class="text-amber-400 text-sm">üëë</span>' : ''}
                                    ${u.isBanned ? '<span class="text-red-400 text-sm">üö´</span>' : ''}
                                </div>
                                <p class="text-neutral-500 text-sm">${u.email}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="showUserKeys('${u.id}')" class="flex items-center gap-2 bg-white/5 hover:bg-white/10 px-3 py-2 rounded-lg transition border border-white/10 text-sm">
                                üîë ${u.keys ? u.keys.length : 0}
                            </button>
                            ${u.id !== currentUser.id ? `
                                <button onclick="openUserManage('${u.id}')" class="bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg transition border border-white/10 text-sm font-medium">
                                    ‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                                </button>
                            ` : '<span class="text-amber-400 text-xs">–≠—Ç–æ –≤—ã</span>'}
                        </div>
                    </div>
                </div>
            `).join('');
        };
    </script>
</body>
</html>
